<div class="container py-4">
  <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
    <h2 class="mb-0">Statistics</h2>
    <div class="d-flex align-items-center gap-3">
      <div class="btn-group">
        <button type="button" class="btn" [ngClass]="viewMode === 'monthly' ? 'btn-primary' : 'btn-outline-secondary'" (click)="viewMode = 'monthly'; loadStatistics()">Monthly</button>
        <button type="button" class="btn" [ngClass]="viewMode === 'yearly' ? 'btn-primary' : 'btn-outline-secondary'" (click)="viewMode = 'yearly'; loadStatistics()">Yearly</button>
      </div>
      <div class="d-flex gap-2">
        @if (viewMode === 'monthly') {
          <select class="form-select" [(ngModel)]="currentMonth" (ngModelChange)="loadStatistics()">
            @for (month of months; track month) {
              <option [value]="month.value">{{ month.name }}</option>
            }
          </select>
        }
        <select class="form-select" [(ngModel)]="currentYear" (ngModelChange)="loadStatistics()">
          @for (year of years; track year) {
            <option [value]="year">{{ year }}</option>
          }
        </select>
      </div>
    </div>
  </div>

  @if (loading) {
    <div class="text-center p-5"><div class="spinner-border text-primary"></div></div>
  }
  @if (error) {
    <div class="alert alert-danger">{{ error }}</div>
  }

  @if (viewMode === 'monthly' && monthlyStats && !loading) {
    <div>
      <div class="row g-4">
        <div class="col-md-4"><div class="card text-center h-100 bg-success-subtle border-success"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Total Income</h6><p class="card-text fs-2 fw-bold">{{ monthlyStats.totalIncome | currency:'EUR' }}</p></div></div></div>
        <div class="col-md-4"><div class="card text-center h-100 bg-danger-subtle border-danger"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Total Expenses</h6><p class="card-text fs-2 fw-bold">{{ monthlyStats.totalExpenses | currency:'EUR' }}</p></div></div></div>
        <div class="col-md-4"><div class="card text-center h-100" [ngClass]="(monthlyStats.totalIncome - monthlyStats.totalExpenses >= 0) ? 'bg-primary-subtle border-primary' : 'bg-warning-subtle border-warning'"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Net Balance</h6><p class="card-text fs-2 fw-bold">{{ (monthlyStats.totalIncome - monthlyStats.totalExpenses) | currency:'EUR' }}</p></div></div></div>
        <div class="col-md-7"><div class="card h-100"><div class="card-body"><h5 class="card-title">Expenses by Category</h5>@if (showChart) {
        <div style="height: 350px;">
          <canvas baseChart [data]="doughnutChartData" [type]="doughnutChartType" [options]="doughnutChartOptions"></canvas>
        </div>
      }</div></div></div>
      <div class="col-md-5"><div class="card h-100"><div class="card-body"><h5 class="card-title">Breakdown</h5><ul class="list-group list-group-flush">@for (item of monthlyStats.expensesByCategory; track item) {
      <li class="list-group-item d-flex justify-content-between align-items-center">{{ item.categoryName || 'Uncategorized' }} <span class="badge bg-primary rounded-pill">{{ item.total | currency:'EUR' }}</span></li>
    }</ul></div></div></div>
  </div>
</div>
}

@if (viewMode === 'yearly' && yearlyStats && !loading) {
  <div>
    <div class="row g-4">
      <div class="col-md-3"><div class="card text-center h-100 bg-success-subtle border-success"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Total Income</h6><p class="fs-4 fw-bold">{{ yearlyStats.totalIncome | currency:'EUR' }}</p></div></div></div>
      <div class="col-md-3"><div class="card text-center h-100 bg-danger-subtle border-danger"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Total Expenses</h6><p class="fs-4 fw-bold">{{ yearlyStats.totalExpenses | currency:'EUR' }}</p></div></div></div>
      <div class="col-md-3"><div class="card text-center h-100 bg-info-subtle border-info"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Avg. Monthly Income</h6><p class="fs-4 fw-bold">{{ yearlyStats.averageMonthlyIncome | currency:'EUR' }}</p></div></div></div>
      <div class="col-md-3"><div class="card text-center h-100 bg-warning-subtle border-warning"><div class="card-body"><h6 class="card-subtitle mb-2 text-muted">Avg. Monthly Expenses</h6><p class="fs-4 fw-bold">{{ yearlyStats.averageMonthlyExpenses | currency:'EUR' }}</p></div></div></div>
      <div class="col-12">
        <div class="card">
          <div class="card-body">
            <h5 class="card-title">Monthly Breakdown for {{ currentYear }}</h5>
            <div style="height: 400px;">
              <canvas baseChart [data]="barChartData" [type]="barChartType" [options]="barChartOptions"></canvas>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
}
</div>